# MSKRun - План разработки сайта для планирования бега по ТТК

## Обзор проекта

Веб-приложение для планирования беговых маршрутов по всем улицам внутри Третьего транспортного кольца Москвы
  с возможностью построения оптимальных маршрутов и отслеживания прогресса.

## Этап 1: Архитектура и подготовка данных
### 1.1 Техническая архитектура

**Frontend:**

- React.js + TypeScript
- Leaflet.js для карт (OpenStreetMap)
- Tailwind CSS для стилизации
- React Query для управления состоянием

**Backend:**

- Node.js + Express.js + TypeScript
- PostgreSQL + PostGIS для геоданных
- Redis для кэширования маршрутов
- JWT для аутентификации

**Инфраструктура:**

- Домен: mskrun.ru
- Хостинг: VPS (например, DigitalOcean)
- CI/CD: GitHub Actions
- SSL сертификат

### 1.2 Сбор и обработка данных улиц ТТК

**Источники данных:**

- OpenStreetMap API (Overpass API)
- Яндекс.Карты API (дополнительная верификация)
- Официальные данные Мосгордумы о названиях улиц

**Критерии включения:**

- Все именованные проезжие части внутри ТТК
- Улицы, переулки, проспекты, площади, набережные
- Пешеходные зоны и парковые дорожки
- Исключение: автомагистрали, закрытые территории

**Структура данных улиц:**

```sql
CREATE TABLE streets (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    type VARCHAR(50) NOT NULL, -- улица, переулок, проспект и т.д.
    district VARCHAR(100),
    length_meters INTEGER,
    geometry GEOGRAPHY(LINESTRING, 4326),
    surface_type VARCHAR(50), -- асфальт, брусчатка и т.д.
    lighting BOOLEAN,
    difficulty_level INTEGER, -- 1-5
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

## Этап 2: Базовый MVP

### 2.1 Backend API

**Основные эндпоинты:**

- `GET /api/streets` - список всех улиц с фильтрацией
- `GET /api/streets/:id` - детали улицы
- `POST /api/routes/plan` - построение маршрута
- `GET /api/districts` - список районов
- `GET /api/stats` - общая статистика

### 2.2 Frontend MVP

**Ключевые компоненты:**

- Интерактивная карта с отображением всех улиц ТТК
- Список улиц с поиском и фильтрацией
- Базовый планировщик маршрутов
- Калькулятор расстояний

**Основной функционал MVP:**

- Просмотр всех улиц на карте
- Поиск улиц по названию
- Фильтрация по районам и типам улиц
- Простое построение маршрута (точка А → точка Б)

## Этап 3: Продвинутые функции планирования

### 3.1 Алгоритмы маршрутизации

**Типы маршрутов:**

- **"Исследователь"** - маршрут через неизведанные улицы
- **"Коллекционер"** - оптимальный путь для покрытия максимума улиц
- **"Повторение"** - маршрут по уже пробежанным улицам
- **"Район"** - маршруты в пределах выбранного района
- **"Дистанция"** - маршрут на заданное расстояние

**Алгоритмы:**

- Алгоритм китайского почтальона (для полного покрытия)
- A* для оптимальных путей
- Генетический алгоритм для сложных маршрутов

### 3.2 Система пользователей

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE,
    username VARCHAR(100) UNIQUE,
    password_hash VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE user_runs (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    streets_covered INTEGER[],
    distance_meters INTEGER,
    duration_seconds INTEGER,
    date DATE,
    route_geometry GEOGRAPHY(LINESTRING, 4326)
);
```

## Этап 4: Геймификация и прогресс

### 4.1 Система достижений

**Типы достижений:**

- "Картограф" - пробежать все улицы района
- "Исследователь ТТК" - покрыть 50%/75%/100% улиц ТТК
- "Знаток переулков" - пробежать все переулки
- "Марафонец районов" - пробежать по всем районам ТТК

### 4.2 Визуализация прогресса

- Тепловая карта пробежанных улиц
- Статистика покрытия по районам
- Календарь активности
- Рейтинг среди друзей

## Этап 5: Дополнительные функции

### 5.1 Социальные функции

- Совместные маршруты
- Группы бегунов по районам
- Соревнования на покрытие улиц
- Отзывы о состоянии улиц

### 5.2 Интеграции

- Strava API для импорта пробежек
- Telegram бот для быстрого планирования
- PWA для мобильного использования

## Этап 6: Оптимизация и запуск (2 недели)

### 6.1 Производительность

- Кэширование популярных маршрутов
- Оптимизация запросов к базе геоданных
- CDN для статических ресурсов
- Сжатие и минификация

### 6.2 Мониторинг и аналитика

- Логирование ошибок (Sentry)
- Метрики производительности
- Google Analytics для пользовательского поведения
- Мониторинг доступности сервера

## База данных улиц - Техническая реализация

### Процесс сбора данных:

1. **Определение границ ТТК**: Получение точных координат Третьего транспортного кольца
2. **Запросы к Overpass API**: Выгрузка всех именованных дорог внутри границ
3. **Фильтрация данных**: Исключение дублей, автомагистралей, закрытых территорий
4. **Валидация**: Сверка с официальными источниками
5. **Геокодирование**: Вычисление точных координат и длин

### Примерный скрипт сбора:

```javascript
// Overpass API запрос для получения всех улиц внутри ТТК
const overpassQuery = `
[out:json][timeout:25];
(
  way["highway"]["name"](poly:"КООРДИНАТЫ_ТТК");
  way["highway"]["addr:street"](poly:"КООРДИНАТЫ_ТТК");
);
out geom;
`;
```


## Риски и их митигация

1. **Неточные данные улиц** → Множественная верификация источников
2. **Сложность маршрутизации** → Поэтапная реализация алгоритмов
3. **Производительность карт** → Кэширование и оптимизация запросов
4. **Низкая вовлеченность** → A/B тестирование интерфейса

## Метрики успеха

- 1000+ зарегистрированных пользователей за первый месяц
- 50+ активных пользователей в день
- 80%+ покрытие улиц ТТК в базе данных
- <2 секунды время построения маршрута
